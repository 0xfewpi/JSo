# JavaScript äºŒæ¬¡æ‰“åŒ…æºç ä¿æŠ¤æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨è®¾è®¡ä¸€ä¸ªJavaScriptäºŒæ¬¡æ‰“åŒ…æºç ä¿æŠ¤æ–¹æ¡ˆï¼Œé€šè¿‡å¤šå±‚åŠ å¯†ã€å‹ç¼©å’ŒåŠ¨æ€åŠ è½½æŠ€æœ¯ï¼Œä¿æŠ¤JavaScriptæºç ä¸è¢«è½»æ˜“é€†å‘åˆ†æã€‚

**æŠ€æœ¯æ ˆé€‰æ‹©**: TypeScript (æ¨è) æˆ– çº¯JavaScript
**ç›®æ ‡**: ç”Ÿæˆå•ä¸€çš„ `main.js` æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰åŠ å¯†å‹ç¼©çš„èµ„æºå’Œè§£å‹é€»è¾‘

## æ ¸å¿ƒè®¾è®¡ç†å¿µ

### åŒå±‚å‹ç¼©ä¿æŠ¤æœºåˆ¶
1. **plugins** ç›®å½• â†’ Brotliæœ€é«˜çº§åˆ«å‹ç¼© (ç¬¬ä¸€å±‚ä¿æŠ¤)
2. **depend** ç›®å½• â†’ Brotliæœ€é«˜çº§åˆ«å‹ç¼© (ç¬¬äºŒå±‚ä¿æŠ¤)
3. **åˆ†å±‚è§£å‹**: pluginså…ˆè§£å‹æ‰§è¡Œå®‰å…¨æ£€æŸ¥ï¼Œé€šè¿‡åæ‰è§£å‹depend

### ä¿æŠ¤ç­–ç•¥é‡ç‚¹
- **é«˜å‹ç¼©ç‡**: ä½¿ç”¨Brotliæœ€é«˜çº§åˆ«å‹ç¼©ï¼Œæœ€å¤§åŒ–å‡å°‘ä½“ç§¯
- **ä»£ç æ··æ·†**: é€šè¿‡æ··æ·†å¢åŠ é€†å‘åˆ†æéš¾åº¦
- **å®‰å…¨æ£€æŸ¥**: ä¾é æŒ‡çº¹è¯†åˆ«å’Œåè°ƒè¯•æœºåˆ¶ä¿æŠ¤
- **WASMåŠ¨æ€åŠ è½½**: Brotliè§£å‹å™¨ä»¥WASMå½¢å¼å†…åµŒï¼ŒåŠ¨æ€åŠ è½½åˆ°å†…å­˜

### æ¶æ„è®¾è®¡è¯´æ˜
**ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¯†ç ä¿æŠ¤ï¼Ÿ**
- Brotliæ˜¯çº¯å‹ç¼©ç®—æ³•ï¼Œä¸æ”¯æŒå¯†ç ä¿æŠ¤
- å‹ç¼©åå†AESåŠ å¯†ä¼šå¢åŠ 20-30%ä½“ç§¯ï¼Œè¿èƒŒå‹ç¼©ç›®æ ‡
- å¯†ç ç®¡ç†å¢åŠ å¤æ‚åº¦ï¼Œå®¹æ˜“æˆä¸ºæ”»å‡»ç‚¹
- **æ›¿ä»£æ–¹æ¡ˆ**: é€šè¿‡ä»£ç æ··æ·† + å®‰å…¨æ£€æŸ¥ + èµ„æºåŠ«æŒå®ç°ä¿æŠ¤

### æ¶æ„è®¾è®¡è¯´æ˜
**ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¯†ç ä¿æŠ¤ï¼Ÿ**
- Brotliæ˜¯çº¯å‹ç¼©ç®—æ³•ï¼Œä¸æ”¯æŒå¯†ç ä¿æŠ¤
- å‹ç¼©åå†AESåŠ å¯†ä¼šå¢åŠ 20-30%ä½“ç§¯ï¼Œè¿èƒŒå‹ç¼©ç›®æ ‡
- å¯†ç ç®¡ç†å¢åŠ å¤æ‚åº¦ï¼Œå®¹æ˜“æˆä¸ºæ”»å‡»ç‚¹
- **æ›¿ä»£æ–¹æ¡ˆ**: é€šè¿‡ä»£ç æ··æ·† + å®‰å…¨æ£€æŸ¥ + èµ„æºåŠ«æŒå®ç°ä¿æŠ¤

## é¡¹ç›®æ¶æ„è®¾è®¡

### 1. å‹ç¼©å™¨æ¨¡å— (Compressor)

#### 1.1 æ ¸å¿ƒåŠŸèƒ½
```typescript
interface CompressorConfig {
  algorithm: 'brotli';
  compressionLevel: 11;      // Brotliæœ€é«˜å‹ç¼©çº§åˆ« (0-11)
  outputFormat: 'base64';    // Base64ç¼–ç è¾“å‡º
}

interface CompressResult {
  compressedData: string;    // å‹ç¼©åçš„Base64å­—ç¬¦ä¸² (å‡ MBå¤§å°)
  metadata: {
    originalSize: number;
    compressedSize: number;
    algorithm: 'brotli';
    compressionLevel: 11;
    compressionRatio: number; // å‹ç¼©ç‡
  };
}
```

#### 1.2 åˆ†ç¦»å‹ç¼©ç­–ç•¥
```typescript
// å‹ç¼©å™¨ä¸»è¦æ–¹æ³•
class BrotliCompressor {
  // å‹ç¼©pluginsç›®å½• - ç¬¬ä¸€å±‚ä¿æŠ¤
  compressPlugins(pluginsDir: string): CompressResult;

  // å‹ç¼©dependç›®å½• - ç¬¬äºŒå±‚ä¿æŠ¤
  compressDepends(dependDir: string): CompressResult;

  // Brotliå‹ç¼©å®ç°
  private compressToBrotli(data: string): CompressResult;
}
```

### 2. ç°æœ‰èµ„æºç»“æ„

#### 2.1 æºæ–‡ä»¶ç»“æ„
```
/depend/                    # ä¾èµ–æ–‡ä»¶ç›®å½• (ç¬¬äºŒå±‚è§£å‹)
â”œâ”€â”€ 0x.js                  # ä¸»è¦çš„æ··æ·†åŠ å¯†JavaScriptæ–‡ä»¶
â”œâ”€â”€ wallet-connect-v4.js   # UMDæ ¼å¼çš„é’±åŒ…è¿æ¥åº“
â”œâ”€â”€ modal-21.css           # æ¨¡æ€æ¡†æ ·å¼æ–‡ä»¶
â””â”€â”€ popup-2.css            # å¼¹çª—æ ·å¼æ–‡ä»¶

/plugins/                   # æ’ä»¶ç›®å½• (ç¬¬ä¸€å±‚è§£å‹)
â”œâ”€â”€ fingerprint.js          # æŒ‡çº¹è¯†åˆ«æ’ä»¶ (UMDæ ¼å¼)
â””â”€â”€ creep.js               # åè°ƒè¯•æ’ä»¶ (UMDæ ¼å¼)

index.js                    # ä¸»å¯åŠ¨é…ç½®æ–‡ä»¶
depend.js                   # ä¾èµ–é…ç½®æ–‡ä»¶
```

#### 2.2 å½“å‰åŠ è½½æœºåˆ¶
```html
<!-- åŸå§‹åŠ è½½æ–¹å¼ -->
<script src="0x.js"></script>

<!-- ä¿æŠ¤åçš„åŠ è½½æ–¹å¼ -->
<script src="main.js"></script>
```

## 3. main.js ä¸»é€»è¾‘è®¾è®¡

### 3.1 æ–‡ä»¶ç»“æ„è®¾è®¡
```typescript
// main.js çš„æ ¸å¿ƒç»“æ„ (æ··æ·†å‰çš„æ¸…æ™°ç‰ˆæœ¬)
class MainLoader {
  // åŒºåŸŸ1: å‹ç¼©æ•°æ®å­˜å‚¨ (ä¸è¿›è¡Œæ··æ·†çš„æ•°æ®åŒºåŸŸ)
  private static COMPRESSED_PLUGINS = "UEsDBBQAAAAIAA..."; // Brotliå‹ç¼©åçš„plugins (å‡ MB)
  private static COMPRESSED_DEPENDS = "UEsDBBQAAAAIAA..."; // Brotliå‹ç¼©åçš„depend (å‡ MB)

  // åŒºåŸŸ2: WASMæ¨¡å—å­˜å‚¨ (ä¸è¿›è¡Œæ··æ·†çš„äºŒè¿›åˆ¶æ•°æ®)
  private static BROTLI_WASM_HEX = "0061736d0100000001..."; // Brotliè§£å‹å™¨WASM (HEXå­—ç¬¦ä¸²)

  // åŒºåŸŸ3: ä¸»é€»è¾‘ä»£ç  (éœ€è¦è¿›è¡Œæ··æ·†çš„åŒºåŸŸ)
  public static async bootstrap(): Promise<void>;
  private static async loadWasmDecompressor(): Promise<any>;
  private static async setupResourceInterception(): Promise<void>;
}
```

### 3.2 æ··æ·†ç­–ç•¥è®¾è®¡
```typescript
// æ··æ·†é…ç½® - AIå·¥å…·å®ç°å‚è€ƒ
interface ObfuscationConfig {
  // æ•°æ®ä¿æŠ¤åŒºåŸŸ (ä¸æ··æ·†)
  preserveStrings: string[];  // ä¿æŠ¤çš„å­—ç¬¦ä¸²æ¨¡å¼
  preserveRegions: {
    start: string;            // åŒºåŸŸå¼€å§‹æ ‡è®°
    end: string;              // åŒºåŸŸç»“æŸæ ‡è®°
    reason: string;           // ä¿æŠ¤åŸå› 
  }[];

  // é€»è¾‘æ··æ·†åŒºåŸŸ (å¼ºæ··æ·†)
  obfuscateRegions: {
    controlFlow: boolean;     // æ§åˆ¶æµæ··æ·†
    identifierRename: boolean; // æ ‡è¯†ç¬¦é‡å‘½å
    stringEncryption: boolean; // å­—ç¬¦ä¸²åŠ å¯†
    deadCodeInjection: boolean; // æ­»ä»£ç æ³¨å…¥
  };
}

// å…·ä½“æ··æ·†é…ç½®
const MAIN_JS_OBFUSCATION: ObfuscationConfig = {
  preserveStrings: [
    "UEsDBBQAAAAIAA",      // Base64å‹ç¼©æ•°æ®å¼€å¤´
    "0061736d01000000",     // WASMé­”æ•°å¼€å¤´
  ],

  preserveRegions: [
    {
      start: "// DATA_REGION_START",
      end: "// DATA_REGION_END",
      reason: "å‹ç¼©æ•°æ®å’ŒWASMäºŒè¿›åˆ¶ä¸èƒ½æ··æ·†"
    }
  ],

  obfuscateRegions: {
    controlFlow: true,        // å¼ºåˆ¶æ§åˆ¶æµæ··æ·†
    identifierRename: true,   // æ‰€æœ‰å˜é‡å‡½æ•°åæ··æ·†
    stringEncryption: true,   // é€»è¾‘å­—ç¬¦ä¸²åŠ å¯†
    deadCodeInjection: true   // æ³¨å…¥å¹²æ‰°ä»£ç 
  }
};
```

### 3.3 å¯åŠ¨æµç¨‹è®¾è®¡ (åŒ…å«WASMåŠ¨æ€åŠ è½½)
```typescript
// main.js å¯åŠ¨æµç¨‹ (æ··æ·†å‰çš„æ¸…æ™°ç‰ˆæœ¬)
async function bootstrap() {
  try {
    // ç¬¬ä¸€æ­¥: åŠ¨æ€åŠ è½½Brotli WASMè§£å‹å™¨
    const brotliWasm = await loadWasmDecompressor();

    // ç¬¬äºŒæ­¥: è§£å‹pluginsç›®å½•
    const pluginsContent = await decompressBrotliWithWasm(
      COMPRESSED_PLUGINS,
      brotliWasm
    );

    // ç¬¬ä¸‰æ­¥: åŠ¨æ€åŠ è½½pluginsåˆ°å†…å­˜
    const plugins = await loadPluginsToMemory(pluginsContent);

    // ç¬¬å››æ­¥: æ‰§è¡Œå®‰å…¨æ£€æŸ¥
    const fingerprintResult = await plugins.fingerprint.fn();
    const creepResult = await plugins.creep.check();

    // ç¬¬äº”æ­¥: å®‰å…¨éªŒè¯
    if (!fingerprintResult || !creepResult) {
      // è§¦å‘æ­»å¾ªç¯å¯¼è‡´é¡µé¢å´©æºƒ
      while(true) {
        console.log("Security check failed");
      }
      return;
    }

    // ç¬¬å…­æ­¥: è§£å‹dependç›®å½• (ä»…åœ¨å®‰å…¨æ£€æŸ¥é€šè¿‡å)
    const dependContent = await decompressBrotliWithWasm(
      COMPRESSED_DEPENDS,
      brotliWasm
    );

    // ç¬¬ä¸ƒæ­¥: å»ºç«‹èµ„æºåŠ«æŒæœºåˆ¶
    await setupResourceInterception(dependContent);

    // ç¬¬å…«æ­¥: å¯åŠ¨ä¸»ä¸šåŠ¡é€»è¾‘ (0x.js)
    await loadMainApplication();

  } catch (error) {
    // é”™è¯¯å¤„ç† - è§¦å‘ä¿æŠ¤æœºåˆ¶
    triggerProtectionMechanism();
  }
}

// WASMåŠ¨æ€åŠ è½½å™¨ (æ­¤éƒ¨åˆ†é€»è¾‘éœ€è¦æ··æ·†)
async function loadWasmDecompressor(): Promise<WebAssembly.Instance> {
  // 1. HEXå­—ç¬¦ä¸²è½¬äºŒè¿›åˆ¶
  const wasmBinary = hexStringToUint8Array(BROTLI_WASM_HEX);

  // 2. ç¼–è¯‘WASMæ¨¡å—
  const wasmModule = await WebAssembly.compile(wasmBinary);

  // 3. å®ä¾‹åŒ–WASM
  const wasmInstance = await WebAssembly.instantiate(wasmModule);

  return wasmInstance;
}

// HEXè½¬æ¢å·¥å…· (æ­¤éƒ¨åˆ†é€»è¾‘éœ€è¦æ··æ·†)
function hexStringToUint8Array(hexString: string): Uint8Array {
  const bytes = new Uint8Array(hexString.length / 2);
  for (let i = 0; i < hexString.length; i += 2) {
    bytes[i / 2] = parseInt(hexString.substr(i, 2), 16);
  }
  return bytes;
}
```

### 3.4 WASMè§£å‹å™¨å®ç°
```typescript
interface DecompressOptions {
  algorithm: 'brotli';
  format: 'base64';
  wasmInstance: WebAssembly.Instance;
}

// ä½¿ç”¨WASMè¿›è¡ŒBrotliè§£å‹ (æ­¤éƒ¨åˆ†é€»è¾‘éœ€è¦æ··æ·†)
async function decompressBrotliWithWasm(
  compressedData: string,
  wasmInstance: WebAssembly.Instance
): Promise<{[filename: string]: string}> {
  // 1. Base64è§£ç 
  const binaryData = atob(compressedData);
  const uint8Array = new Uint8Array(binaryData.length);
  for (let i = 0; i < binaryData.length; i++) {
    uint8Array[i] = binaryData.charCodeAt(i);
  }

  // 2. è°ƒç”¨WASMè§£å‹å‡½æ•°
  const wasmMemory = wasmInstance.exports.memory as WebAssembly.Memory;
  const decompressFunc = wasmInstance.exports.brotli_decompress as Function;

  // 3. å°†æ•°æ®å†™å…¥WASMå†…å­˜
  const inputPtr = wasmInstance.exports.malloc(uint8Array.length);
  const memoryView = new Uint8Array(wasmMemory.buffer);
  memoryView.set(uint8Array, inputPtr);

  // 4. æ‰§è¡Œè§£å‹
  const outputPtr = decompressFunc(inputPtr, uint8Array.length);
  const outputSize = wasmInstance.exports.get_output_size();

  // 5. è¯»å–è§£å‹ç»“æœ
  const decompressed = memoryView.slice(outputPtr, outputPtr + outputSize);
  const decoder = new TextDecoder();
  const jsonString = decoder.decode(decompressed);

  // 6. æ¸…ç†WASMå†…å­˜
  wasmInstance.exports.free(inputPtr);
  wasmInstance.exports.free(outputPtr);

  // 7. è§£ææ–‡ä»¶ç»“æ„
  return JSON.parse(jsonString);
}
```

### 3.4 èµ„æºåŠ«æŒæœºåˆ¶
```typescript
// èµ„æºæ‹¦æˆªå™¨è®¾ç½®
async function setupResourceInterception(dependContent: {[key: string]: string}) {
  // ç”ŸæˆUUIDæ˜ å°„è¡¨
  const urlMappings = generateUUIDMappings(dependContent);

  // åˆ›å»ºBlob URLs
  const blobUrls = await createBlobUrls(dependContent, urlMappings);

  // è®¾ç½®Service Workeræ‹¦æˆª (æ¨èæ–¹æ¡ˆ)
  if ('serviceWorker' in navigator) {
    await setupServiceWorkerInterception(blobUrls);
  } else {
    // é™çº§æ–¹æ¡ˆ: Fetch/XHRåŠ«æŒ
    setupFetchInterception(blobUrls);
  }
}

// UUIDæ˜ å°„ç”Ÿæˆ
function generateUUIDMappings(files: {[key: string]: string}): {[key: string]: string} {
  const mappings: {[key: string]: string} = {};

  Object.keys(files).forEach(filename => {
    const uuid = crypto.randomUUID();
    const extension = filename.split('.').pop();
    mappings[filename] = `${uuid}.${extension}`;

    // æ”¯æŒå¤šç§è·¯å¾„æ ¼å¼
    mappings[`/${filename}`] = `${uuid}.${extension}`;
    mappings[`/script/${filename}`] = `${uuid}.${extension}`;
    mappings[`/css/${filename}`] = `${uuid}.${extension}`;
  });

  return mappings;
}
```

## 4. æŠ€æœ¯å®ç°ç»†èŠ‚

### 4.1 WASMé›†æˆçš„Brotliè§£å†³æ–¹æ¡ˆ

#### 4.1.1 æ„å»ºæ—¶å‹ç¼© (Node.jsç¯å¢ƒ)
```typescript
// æ„å»ºæ—¶ä½¿ç”¨Node.jsçš„brotliè¿›è¡Œå‹ç¼©
import { brotliCompressSync } from 'zlib';
import { readFileSync, writeFileSync } from 'fs';

class BuildTimeBrotliCompressor {
  static compressDirectory(dirPath: string): CompressResult {
    // 1. è¯»å–ç›®å½•æ‰€æœ‰æ–‡ä»¶
    const files = this.readDirectoryRecursive(dirPath);

    // 2. åˆ›å»ºæ–‡ä»¶æ˜ å°„
    const fileMap = this.createFileMap(files);
    const jsonString = JSON.stringify(fileMap);

    // 3. ä½¿ç”¨Node.js Brotliæœ€é«˜çº§åˆ«å‹ç¼©
    const compressed = brotliCompressSync(Buffer.from(jsonString), {
      params: {
        [constants.BROTLI_PARAM_QUALITY]: 11,        // æœ€é«˜è´¨é‡
        [constants.BROTLI_PARAM_LGWIN]: 24,          // æœ€å¤§çª—å£
        [constants.BROTLI_PARAM_LGBLOCK]: 0,         // è‡ªåŠ¨å—å¤§å°
        [constants.BROTLI_PARAM_MODE]: constants.BROTLI_MODE_GENERIC
      }
    });

    // 4. è½¬æ¢ä¸ºBase64
    const base64 = compressed.toString('base64');

    return {
      compressedData: base64,
      metadata: {
        originalSize: Buffer.from(jsonString).length,
        compressedSize: compressed.length,
        algorithm: 'brotli',
        compressionLevel: 11,
        compressionRatio: compressed.length / Buffer.from(jsonString).length
      }
    };
  }
}
```

#### 4.1.2 WASMæ¨¡å—å‡†å¤‡
```typescript
// WASMæ„å»ºé…ç½®
interface WasmBuildConfig {
  source: 'brotli-c';           // ä½¿ç”¨Cè¯­è¨€çš„Brotliå®ç°
  target: 'wasm32';             // ç¼–è¯‘ç›®æ ‡
  optimization: 'size';         // ä¼˜åŒ–ä½“ç§¯
  exports: string[];            // å¯¼å‡ºå‡½æ•°åˆ—è¡¨
}

// WASMæ„å»ºæµç¨‹
class WasmBuilder {
  static async buildBrotliWasm(): Promise<{
    wasmBinary: Uint8Array;
    hexString: string;
  }> {
    // 1. ç¼–è¯‘Brotli Cä»£ç åˆ°WASM
    const wasmBinary = await this.compileCToWasm({
      source: './brotli-src/',
      exports: [
        'brotli_decompress',
        'malloc',
        'free',
        'get_output_size'
      ],
      optimization: '-Os'  // ä½“ç§¯ä¼˜åŒ–
    });

    // 2. è½¬æ¢ä¸ºHEXå­—ç¬¦ä¸²
    const hexString = Array.from(wasmBinary)
      .map(b => b.toString(16).padStart(2, '0'))
      .join('');

    return { wasmBinary, hexString };
  }

  // å°†WASMé›†æˆåˆ°main.js
  static integrateWasmToMainJs(wasmHex: string, mainJsTemplate: string): string {
    return mainJsTemplate.replace(
      '{{WASM_HEX_PLACEHOLDER}}',
      wasmHex
    );
  }
}
```

#### 4.1.3 è¿è¡Œæ—¶WASMåŠ è½½å™¨ (éœ€è¦æ··æ·†çš„éƒ¨åˆ†)
```typescript
// è¿è¡Œæ—¶WASMç®¡ç†å™¨
class RuntimeWasmManager {
  private static wasmInstance: WebAssembly.Instance | null = null;

  // åŠ¨æ€åŠ è½½WASMæ¨¡å—
  static async loadBrotliWasm(hexString: string): Promise<WebAssembly.Instance> {
    if (this.wasmInstance) {
      return this.wasmInstance;
    }

    // 1. HEXè½¬äºŒè¿›åˆ¶
    const wasmBinary = this.hexToUint8Array(hexString);

    // 2. ç¼–è¯‘WASMæ¨¡å—
    const wasmModule = await WebAssembly.compile(wasmBinary);

    // 3. å®ä¾‹åŒ–WASM (æä¾›å†…å­˜ç®¡ç†å‡½æ•°)
    this.wasmInstance = await WebAssembly.instantiate(wasmModule, {
      env: {
        memory: new WebAssembly.Memory({ initial: 256 }),
        __memory_base: 0,
        __table_base: 0,
        abort: () => { throw new Error('WASM abort'); }
      }
    });

    return this.wasmInstance;
  }

  // HEXå­—ç¬¦ä¸²è½¬Uint8Array (æ­¤å‡½æ•°éœ€è¦æ··æ·†)
  private static hexToUint8Array(hexString: string): Uint8Array {
    const bytes = new Uint8Array(hexString.length / 2);
    for (let i = 0; i < hexString.length; i += 2) {
      bytes[i / 2] = parseInt(hexString.substr(i, 2), 16);
    }
    return bytes;
  }

  // ä½¿ç”¨WASMè§£å‹æ•°æ® (æ­¤å‡½æ•°éœ€è¦æ··æ·†)
  static async decompressWithWasm(
    compressedBase64: string,
    wasmInstance: WebAssembly.Instance
  ): Promise<string> {
    // å®ç°WASMè§£å‹é€»è¾‘...
    // (è¯¦è§å‰é¢çš„decompressBrotliWithWasmå‡½æ•°)
  }
}
```

### 4.2 æ„å»ºå·¥å…·é›†æˆ
```typescript
// æ„å»ºè„šæœ¬ç¤ºä¾‹ (build.ts)
interface BuildConfig {
  inputDirs: {
    plugins: string;
    depend: string;
  };
  output: {
    filename: string;
    obfuscate: boolean;
  };
  compression: {
    algorithm: 'brotli';
    level: 11;               // å›ºå®šä½¿ç”¨æœ€é«˜å‹ç¼©çº§åˆ«
  };
  security: {
    enableFingerprint: boolean;
    enableAntiDebug: boolean;
  };
}

class ProjectBuilder {
  async build(config: BuildConfig): Promise<void> {
    // 1. å‹ç¼©pluginsç›®å½•
    const pluginsResult = await this.compressDirectory(
      config.inputDirs.plugins
    );

    // 2. å‹ç¼©dependç›®å½•
    const dependResult = await this.compressDirectory(
      config.inputDirs.depend
    );

    // 3. ç”Ÿæˆmain.js
    const mainJs = await this.generateMainJs({
      pluginsData: pluginsResult.compressedData,
      dependData: dependResult.compressedData,
      metadata: {
        pluginsMetadata: pluginsResult.metadata,
        dependMetadata: dependResult.metadata
      }
    });

    // 4. ä»£ç æ··æ·† (å¯é€‰)
    if (config.output.obfuscate) {
      const obfuscatedJs = await this.obfuscateCode(mainJs);
      await this.writeFile(config.output.filename, obfuscatedJs);
    } else {
      await this.writeFile(config.output.filename, mainJs);
    }
  }
}
```

## 5. AIå¼€å‘å·¥å…·å®ç°æŒ‡å—

### 5.1 å…³é”®å®ç°æ–‡ä»¶æ¸…å•
```
src/
â”œâ”€â”€ compressor/
â”‚   â”œâ”€â”€ SecureCompressor.ts        # æ ¸å¿ƒå‹ç¼©å™¨ç±»
â”‚   â”œâ”€â”€ PasswordManager.ts         # å¯†ç ç®¡ç†å’Œæ··æ·†
â”‚   â””â”€â”€ CompressionAlgorithms.ts   # æ”¯æŒçš„å‹ç¼©ç®—æ³•
â”œâ”€â”€ loader/
â”‚   â”œâ”€â”€ MainLoader.ts              # main.jsä¸»åŠ è½½å™¨
â”‚   â”œâ”€â”€ ResourceInterceptor.ts     # èµ„æºæ‹¦æˆªå™¨
â”‚   â””â”€â”€ BlobUrlManager.ts          # Blob URLç®¡ç†
â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ FingerprintChecker.ts      # æŒ‡çº¹è¯†åˆ«
â”‚   â”œâ”€â”€ AntiDebugger.ts            # åè°ƒè¯•æœºåˆ¶
â”‚   â””â”€â”€ SecurityValidator.ts       # å®‰å…¨éªŒè¯å™¨
â”œâ”€â”€ builder/
â”‚   â”œâ”€â”€ ProjectBuilder.ts          # é¡¹ç›®æ„å»ºå™¨
â”‚   â”œâ”€â”€ CodeObfuscator.ts          # ä»£ç æ··æ·†å™¨
â”‚   â””â”€â”€ ConfigManager.ts           # é…ç½®ç®¡ç†
â””â”€â”€ types/
    â””â”€â”€ index.ts                   # TypeScriptç±»å‹å®šä¹‰
```

### 5.2 æ ¸å¿ƒæ¥å£å®šä¹‰
```typescript
// types/index.ts - AIå¼€å‘å·¥å…·éœ€è¦çš„å®Œæ•´ç±»å‹å®šä¹‰
export interface ProjectConfig {
  input: {
    pluginsDir: string;
    dependDir: string;
    configFile?: string;
  };
  output: {
    filename: string;
    directory: string;
  };
  compression: {
    algorithm: 'brotli';
    level: 11;                 // Brotliæœ€é«˜å‹ç¼©çº§åˆ«
    passwordProtected: true;   // å¼ºåˆ¶å¯ç”¨å¯†ç ä¿æŠ¤
  };
  security: {
    enableFingerprint: boolean;
    enableAntiDebug: boolean;
    customSecurityChecks?: string[];
  };
  obfuscation: {
    enabled: boolean;
    preserveCompressedStrings: boolean;
    level: 'basic' | 'advanced' | 'maximum';
  };
}

export interface CompressedBundle {
  plugins: {
    data: string;           // å‹ç¼©åçš„å­—ç¬¦ä¸² (å‡ MB)
    password: string;       // æ··æ·†åçš„è§£å‹å¯†ç 
    metadata: BundleMetadata;
  };
  depends: {
    data: string;           // å‹ç¼©åçš„å­—ç¬¦ä¸² (å‡ MB)
    password: string;       // æ··æ·†åçš„è§£å‹å¯†ç 
    metadata: BundleMetadata;
  };
}

export interface BundleMetadata {
  originalSize: number;
  compressedSize: number;
  compressionRatio: number;
  fileCount: number;
  algorithm: string;
  createdAt: Date;
}
```

### 5.3 å®ç°ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»
```typescript
// å¼€å‘é¡ºåºå»ºè®® (AIå·¥å…·å‚è€ƒ)
const IMPLEMENTATION_ORDER = [
  // ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€è®¾æ–½
  {
    priority: 1,
    files: ['types/index.ts', 'compressor/CompressionAlgorithms.ts'],
    description: 'å»ºç«‹ç±»å‹ç³»ç»Ÿå’ŒåŸºç¡€å‹ç¼©ç®—æ³•'
  },

  // ç¬¬äºŒé˜¶æ®µ: æ ¸å¿ƒå‹ç¼©å™¨
  {
    priority: 2,
    files: ['compressor/SecureCompressor.ts', 'compressor/PasswordManager.ts'],
    description: 'å®ç°å¯†ç ä¿æŠ¤çš„å‹ç¼©å™¨',
    dependencies: ['types/index.ts', 'compressor/CompressionAlgorithms.ts']
  },

  // ç¬¬ä¸‰é˜¶æ®µ: å®‰å…¨æ¨¡å—
  {
    priority: 3,
    files: ['security/FingerprintChecker.ts', 'security/AntiDebugger.ts'],
    description: 'å®ç°å®‰å…¨æ£€æŸ¥æœºåˆ¶',
    dependencies: ['types/index.ts']
  },

  // ç¬¬å››é˜¶æ®µ: åŠ è½½å™¨
  {
    priority: 4,
    files: ['loader/MainLoader.ts', 'loader/ResourceInterceptor.ts'],
    description: 'å®ç°è¿è¡Œæ—¶åŠ è½½å’Œèµ„æºæ‹¦æˆª',
    dependencies: ['compressor/SecureCompressor.ts', 'security/*']
  },

  // ç¬¬äº”é˜¶æ®µ: æ„å»ºå·¥å…·
  {
    priority: 5,
    files: ['builder/ProjectBuilder.ts', 'builder/CodeObfuscator.ts'],
    description: 'å®ç°å®Œæ•´çš„æ„å»ºæµç¨‹',
    dependencies: ['compressor/*', 'loader/*', 'security/*']
  }
];
```

### 5.4 å…³é”®ç®—æ³•å®ç°æç¤º
```typescript
// AIå¼€å‘å·¥å…·å®ç°å‚è€ƒ
class SecureCompressor {
  // å…³é”®æ–¹æ³•1: ç›®å½•å‹ç¼© (ä½¿ç”¨Brotliæœ€é«˜çº§åˆ«)
  async compressDirectory(dirPath: string, password: string): Promise<CompressResult> {
    // 1. é€’å½’è¯»å–ç›®å½•æ‰€æœ‰æ–‡ä»¶
    const files = await this.readDirectoryRecursive(dirPath);

    // 2. åˆ›å»ºæ–‡ä»¶æ˜ å°„å¯¹è±¡
    const fileMap = this.createFileMap(files);

    // 3. åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²
    const jsonString = JSON.stringify(fileMap);

    // 4. Brotliæœ€é«˜çº§åˆ«å‹ç¼© + AESåŠ å¯†
    const compressed = await this.compressWithBrotli(jsonString, password);

    return {
      compressedData: compressed,
      password: this.obfuscatePassword(password),
      metadata: this.generateMetadata(files, compressed)
    };
  }

  // Brotliå‹ç¼©å®ç°
  private async compressWithBrotli(data: string, password: string): Promise<string> {
    const encoder = new TextEncoder();
    const inputBuffer = encoder.encode(data);

    // ä½¿ç”¨æœ€é«˜å‹ç¼©çº§åˆ«
    const compressed = brotli.compress(inputBuffer, {
      quality: 11,        // æœ€é«˜å‹ç¼©è´¨é‡
      lgwin: 24,          // æœ€å¤§çª—å£å¤§å°
      lgblock: 0          // è‡ªåŠ¨é€‰æ‹©å—å¤§å°
    });

    // AES-256-GCMåŠ å¯†
    return CryptoJS.AES.encrypt(
      CryptoJS.lib.WordArray.create(compressed),
      password,
      { mode: CryptoJS.mode.GCM }
    ).toString();
  }

  // å…³é”®æ–¹æ³•2: å¯†ç æ··æ·†
  private obfuscatePassword(password: string): string {
    // å®ç°å¯†ç æ··æ·†ç®—æ³•
    // å»ºè®®: ä½¿ç”¨å¤šå±‚ç¼–ç  + å­—ç¬¦æ›¿æ¢ + ä½è¿ç®—
    const encoded = btoa(password);
    const scrambled = this.scrambleString(encoded);
    const obfuscated = this.applyBitOperations(scrambled);

    return obfuscated;
  }
}
```

## 6. æœ€ç»ˆäº§ç‰©è§„æ ¼ä¸æ··æ·†ç­–ç•¥

### 6.1 main.js æœ€ç»ˆç»“æ„ (æ··æ·†å)
```javascript
// main.js çš„æœ€ç»ˆç»“æ„ (AIå·¥å…·ç”Ÿæˆç›®æ ‡)
(function() {
  'use strict';

  // DATA_REGION_START - æ•°æ®åŒºåŸŸ (ä¸æ··æ·†)
  // åŒºåŸŸ1: Brotliå‹ç¼©æ•°æ® (å‡ MBå¤§å°ï¼ŒBase64æ ¼å¼)
  var _0x1a2b3c = "UEsDBBQAAAAIAA1dB3gUVRr+xQwEBAQEBAQE..."; // pluginså‹ç¼©æ•°æ®
  var _0x4d5e6f = "UEsDBBQAAAAIAA1dB3gUVRr+xQwEBAQEBAQE..."; // dependå‹ç¼©æ•°æ®

  // åŒºåŸŸ2: Brotli WASMè§£å‹å™¨ (HEXæ ¼å¼)
  var _0x7g8h9i = "0061736d0100000001070160027f7f017f60017f017f60000060017f00" +
                   "60027f7f0060037f7f7f017f60047f7f7f7f017f0203080007000102030405" +
                   // ... å‡ KBçš„WASMäºŒè¿›åˆ¶æ•°æ®
                   "0b0f010041000b09656e636f64696e67";
  // DATA_REGION_END

  // åŒºåŸŸ3: æ ¸å¿ƒé€»è¾‘ (å¼ºæ··æ·†)
  var _0xa1b2c3 = function() {
    // æ··æ·†åçš„bootstrapå‡½æ•°
    return new Promise(function(_0xd4e5f6, _0xg7h8i9) {
      // å¤§é‡æ··æ·†çš„é€»è¾‘ä»£ç ...
    });
  };

  // åŒºåŸŸ4: è‡ªåŠ¨å¯åŠ¨ (æ··æ·†)
  _0xa1b2c3()['catch'](function(_0xj1k2l3) {
    while(!![]){ console['log']('Protection activated'); }
  });

})();
```

### 6.2 æ··æ·†å®ç°ç­–ç•¥

#### 6.2.1 æ•°æ®åŒºåŸŸä¿æŠ¤
```typescript
// æ„å»ºå·¥å…·å®ç° - æ•°æ®åŒºåŸŸæ ‡è®°
class ObfuscationBuilder {
  generateMainJs(data: {
    pluginsData: string;
    dependData: string;
    wasmHex: string;
  }): string {
    return `
(function() {
  'use strict';

  // DATA_REGION_START
  var _0x${this.generateRandomId()} = "${data.pluginsData}";
  var _0x${this.generateRandomId()} = "${data.dependData}";
  var _0x${this.generateRandomId()} = "${data.wasmHex}";
  // DATA_REGION_END

  ${this.generateObfuscatedLogic()}

})();
    `;
  }

  // åº”ç”¨æ··æ·†æ—¶è·³è¿‡æ•°æ®åŒºåŸŸ
  applyObfuscation(code: string): string {
    const dataRegionRegex = /\/\/ DATA_REGION_START[\s\S]*?\/\/ DATA_REGION_END/;
    const dataRegion = code.match(dataRegionRegex)?.[0] || '';
    const logicCode = code.replace(dataRegionRegex, '/* DATA_PLACEHOLDER */');

    // åªå¯¹é€»è¾‘ä»£ç è¿›è¡Œæ··æ·†
    const obfuscatedLogic = this.obfuscateCode(logicCode);

    // å°†æ•°æ®åŒºåŸŸé‡æ–°æ’å…¥
    return obfuscatedLogic.replace('/* DATA_PLACEHOLDER */', dataRegion);
  }
}
```

#### 6.2.2 é€»è¾‘ä»£ç æ··æ·†é…ç½®
```typescript
// javascript-obfuscator é…ç½®
const OBFUSCATION_CONFIG = {
  // åŸºç¡€æ··æ·†
  compact: true,
  controlFlowFlattening: true,
  controlFlowFlatteningThreshold: 1,

  // æ ‡è¯†ç¬¦æ··æ·†
  identifierNamesGenerator: 'hexadecimal',
  renameGlobals: true,
  renameProperties: true,

  // å­—ç¬¦ä¸²æ··æ·†
  stringArray: true,
  stringArrayThreshold: 1,
  stringArrayEncoding: ['base64', 'rc4'],
  stringArrayWrappersCount: 5,
  stringArrayWrappersChainedCalls: true,

  // æ­»ä»£ç æ³¨å…¥
  deadCodeInjection: true,
  deadCodeInjectionThreshold: 1,

  // æ•°å­—æ··æ·†
  numbersToExpressions: true,

  // å‡½æ•°æ··æ·†
  splitStrings: true,
  splitStringsChunkLength: 5,

  // é«˜çº§æ··æ·†
  selfDefending: true,
  debugProtection: true,
  debugProtectionInterval: true,

  // ä¿æŠ¤è®¾ç½®
  ignoreRequireImports: false,
  target: 'browser',

  // æ•°æ®ä¿æŠ¤ - å…³é”®é…ç½®
  reservedStrings: [
    'UEsDBBQAAAAIAA',  // Base64æ•°æ®å¼€å¤´
    '0061736d01000000', // WASMé­”æ•°
    'DATA_REGION_START',
    'DATA_REGION_END'
  ]
};
```

### 6.3 æ„å»ºäº§ç‰©ç‰¹æ€§
- **æ–‡ä»¶å¤§å°**: é¢„è®¡8-25MB (åŸå§‹èµ„æº + WASM + æ··æ·†å¼€é”€)
  - å‹ç¼©æ•°æ®: 5-20MB (å–å†³äºåŸå§‹èµ„æº)
  - WASMæ¨¡å—: 50-200KB
  - æ··æ·†é€»è¾‘: 100-500KB
- **åŠ è½½æ—¶é—´**:
  - WASMç¼–è¯‘: 100-300ms
  - é¦–æ¬¡è§£å‹: 1-3ç§’
  - æ€»å¯åŠ¨æ—¶é—´: 2-5ç§’
- **å†…å­˜å ç”¨**: è¿è¡Œæ—¶å ç”¨åŸå§‹èµ„æº3-4å€å†…å­˜
- **å…¼å®¹æ€§**: æ”¯æŒWebAssemblyçš„ç°ä»£æµè§ˆå™¨ (Chrome 57+, Firefox 52+)

## 7. æ¶æ„è®¾è®¡éªŒè¯

### 7.1 è®¾è®¡é—®é¢˜æ£€æŸ¥æ¸…å•
- âœ… **å‹ç¼©å™¨è®¾è®¡**: æ˜ç¡®äº†åŒå±‚å‹ç¼©æœºåˆ¶å’Œå¯†ç ä¿æŠ¤
- âœ… **è§£å‹æµç¨‹**: è¯¦ç»†è®¾è®¡äº†åˆ†å±‚è§£å‹å’Œå®‰å…¨æ£€æŸ¥
- âœ… **å¯†ç ç®¡ç†**: å®ç°äº†å¯†ç æ··æ·†å’ŒäºŒæ¬¡ä¿æŠ¤æœºåˆ¶
- âœ… **èµ„æºåŠ«æŒ**: æä¾›äº†Service Workerå’ŒFetchåŠ«æŒä¸¤ç§æ–¹æ¡ˆ
- âœ… **é”™è¯¯å¤„ç†**: è®¾è®¡äº†å®Œå–„çš„å®‰å…¨é˜²æŠ¤å’Œé”™è¯¯å¤„ç†æœºåˆ¶

### 7.2 æŠ€æœ¯å¯è¡Œæ€§åˆ†æ
```typescript
// å…³é”®æŠ€æœ¯ç‚¹éªŒè¯
const TECHNICAL_FEASIBILITY = {
  compression: {
    algorithm: 'brotli',            // Googleå¼€å‘çš„é«˜æ•ˆå‹ç¼©ç®—æ³•
    library: 'brotli-wasm',         // æˆç†Ÿçš„WebAssemblyå®ç°
    level: 11,                      // æœ€é«˜å‹ç¼©çº§åˆ«
    feasible: true
  },

  encryption: {
    algorithms: ['AES-256-GCM'],
    libraries: ['crypto-js', 'WebCrypto API'],
    feasible: true
  },

  resourceInterception: {
    serviceWorker: true,  // ç°ä»£æµè§ˆå™¨æ”¯æŒ
    fetchHijacking: true, // ç®€å•å¯é 
    feasible: true
  },

  blobUrls: {
    support: 'universal',  // æ‰€æœ‰ç°ä»£æµè§ˆå™¨æ”¯æŒ
    memoryManagement: 'manual', // éœ€è¦æ‰‹åŠ¨ç®¡ç†
    feasible: true
  }
};
```

## 8. è¯¦ç»†æŠ€æœ¯è§„æ ¼

### 8.1 å‹ç¼©ä¸åŠ å¯†æ¨¡å—

#### 8.1.1 å‹ç¼©ç®—æ³•è§„æ ¼
```typescript
// å›ºå®šä½¿ç”¨Brotliå‹ç¼©ç®—æ³•
const COMPRESSION_CONFIG = {
  algorithm: 'brotli' as const,
  level: 11,                    // æœ€é«˜å‹ç¼©çº§åˆ« (0-11)
  windowSize: 24,               // æœ€å¤§çª—å£å¤§å° (10-24)
  blockSize: 0,                 // è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å—å¤§å°
  mode: 'generic'               // é€šç”¨å‹ç¼©æ¨¡å¼
} as const;

// Brotliå‹ç¼©ç‰¹æ€§ (AIå·¥å…·å‚è€ƒ)
const BROTLI_FEATURES = {
  compressionRatio: 'maximum',   // æœ€é«˜å‹ç¼©ç‡
  speed: 'slow',                 // å‹ç¼©é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†è§£å‹å¿«
  support: 'modern',             // ç°ä»£æµè§ˆå™¨æ”¯æŒ
  memoryUsage: 'high',           // é«˜å†…å­˜ä½¿ç”¨ï¼Œæ¢å–æœ€ä½³å‹ç¼©ç‡
  decompressSpeed: 'fast'        // è§£å‹é€Ÿåº¦å¿«
};
```

#### 8.1.2 åŠ å¯†æ–¹æ¡ˆ
```typescript
interface EncryptionConfig {
  algorithm: 'AES-256-GCM';
  keyDerivation: 'PBKDF2';
  iterations: number;
  saltLength: number;
}

// æ¨èé…ç½®
const RECOMMENDED_ENCRYPTION: EncryptionConfig = {
  algorithm: 'AES-256-GCM',
  keyDerivation: 'PBKDF2',
  iterations: 100000,      // é˜²æ­¢æš´åŠ›ç ´è§£
  saltLength: 32           // 256ä½ç›å€¼
};
```

### 8.2 èµ„æºåŠ«æŒæŠ€æœ¯æ–¹æ¡ˆ

#### 8.2.1 Service Worker æ–¹æ¡ˆ (æ¨è)
```typescript
// service-worker.ts - AIå·¥å…·å®ç°å‚è€ƒ
class ResourceInterceptor {
  private blobUrlMap: Map<string, string> = new Map();

  async setupServiceWorker(blobUrls: {[key: string]: string}): Promise<void> {
    // æ³¨å†ŒService Worker
    const registration = await navigator.serviceWorker.register('/sw.js');

    // ç­‰å¾…æ¿€æ´»
    await this.waitForActivation(registration);

    // å‘é€Blob URLæ˜ å°„åˆ°Service Worker
    await this.sendBlobMappings(blobUrls);
  }

  // Service Workerå†…éƒ¨é€»è¾‘
  handleFetchEvent(event: FetchEvent): void {
    const url = event.request.url;

    if (this.shouldIntercept(url)) {
      event.respondWith(this.getBlobResponse(url));
    }
  }

  private shouldIntercept(url: string): boolean {
    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ‹¦æˆªæ­¤URL
    return this.blobUrlMap.has(this.extractFilename(url));
  }
}
```

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- âœ… å®Œå…¨æ§åˆ¶ç½‘ç»œè¯·æ±‚
- âœ… æ”¯æŒæ‰€æœ‰ç±»å‹çš„èµ„æºåŠ è½½ (`<script>`, `<link>`, `fetch()`, `XHR`)
- âœ… å¯ä»¥å¤„ç†è·¨åŸŸè¯·æ±‚
- âœ… æŒä¹…åŒ–æ‹¦æˆªï¼Œé¡µé¢åˆ·æ–°åä»æœ‰æ•ˆ

**æŠ€æœ¯é™åˆ¶**ï¼š
- âŒ éœ€è¦HTTPSç¯å¢ƒ (localhosté™¤å¤–)
- âŒ é¦–æ¬¡æ³¨å†Œæœ‰å»¶è¿Ÿ (çº¦100-500ms)
- âŒ è°ƒè¯•ç›¸å¯¹å¤æ‚

#### 8.2.2 Fetch/XHR åŠ«æŒæ–¹æ¡ˆ (é™çº§)
```typescript
// fetch-interceptor.ts - AIå·¥å…·å®ç°å‚è€ƒ
class FetchInterceptor {
  private originalFetch: typeof fetch;
  private originalXHR: typeof XMLHttpRequest;
  private blobUrlMap: Map<string, string>;

  setup(blobUrls: {[key: string]: string}): void {
    this.blobUrlMap = new Map(Object.entries(blobUrls));
    this.hijackFetch();
    this.hijackXHR();
  }

  private hijackFetch(): void {
    this.originalFetch = window.fetch;

    window.fetch = async (input: RequestInfo | URL, init?: RequestInit) => {
      const url = typeof input === 'string' ? input : input.url;

      if (this.shouldIntercept(url)) {
        const blobUrl = this.getBlobUrl(url);
        return new Response(await this.getBlobContent(blobUrl));
      }

      return this.originalFetch(input, init);
    };
  }

  private hijackXHR(): void {
    const self = this;
    const OriginalXHR = XMLHttpRequest;

    window.XMLHttpRequest = function() {
      const xhr = new OriginalXHR();
      const originalOpen = xhr.open;

      xhr.open = function(method: string, url: string, ...args: any[]) {
        if (self.shouldIntercept(url)) {
          const blobUrl = self.getBlobUrl(url);
          return originalOpen.call(this, method, blobUrl, ...args);
        }
        return originalOpen.call(this, method, url, ...args);
      };

      return xhr;
    };
  }
}
```

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- âœ… å®ç°ç®€å•ï¼Œæ— éœ€HTTPS
- âœ… ç«‹å³ç”Ÿæ•ˆï¼Œæ— å»¶è¿Ÿ
- âœ… è°ƒè¯•ç®€å•

**æŠ€æœ¯é™åˆ¶**ï¼š
- âŒ æ— æ³•æ‹¦æˆª`<script>`ã€`<link>`ç­‰æ ‡ç­¾åŠ è½½
- âŒ å¯èƒ½è¢«å…¶ä»–è„šæœ¬è¦†ç›–
- âŒ éœ€è¦åœ¨æ‰€æœ‰å…¶ä»–è„šæœ¬ä¹‹å‰æ‰§è¡Œ

### 3. Blob URL ç®¡ç†ç³»ç»Ÿ

#### 3.1 UUIDç”Ÿæˆç­–ç•¥
- ä½¿ç”¨ `crypto.randomUUID()` æˆ–è‡ªå®šä¹‰UUIDç”Ÿæˆå™¨
- æ¯æ¬¡é¡µé¢åŠ è½½ç”Ÿæˆæ–°çš„æ˜ å°„å…³ç³»
- æ”¯æŒæ–‡ä»¶æ‰©å±•åä¿ç•™ï¼ˆå¯é€‰ï¼‰

#### 3.2 å†…å­˜ç®¡ç†
- åŠæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„Blob URL
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®ç°LRUç¼“å­˜æœºåˆ¶

### 4. å®‰å…¨é˜²æŠ¤æœºåˆ¶

#### 4.1 æŒ‡çº¹è¯†åˆ« (fingerprint.js)
- **æµè§ˆå™¨æŒ‡çº¹**ï¼šCanvasã€WebGLã€éŸ³é¢‘æŒ‡çº¹
- **ç¡¬ä»¶æŒ‡çº¹**ï¼šå±å¹•åˆ†è¾¨ç‡ã€æ—¶åŒºã€è¯­è¨€
- **è¡Œä¸ºæŒ‡çº¹**ï¼šé¼ æ ‡ç§»åŠ¨ã€é”®ç›˜è¾“å…¥æ¨¡å¼

#### 4.2 åè°ƒè¯• (creep.js)
- **å¼€å‘è€…å·¥å…·æ£€æµ‹**ï¼šæ§åˆ¶å°å¤§å°å˜åŒ–
- **è°ƒè¯•å™¨æ£€æµ‹**ï¼š`debugger` è¯­å¥æ‰§è¡Œæ—¶é—´
- **ä»£ç å®Œæ•´æ€§æ£€æŸ¥**ï¼šå‡½æ•°toString()éªŒè¯

### 5. æ„å»ºæµç¨‹è®¾è®¡

#### 5.1 æ‰“åŒ…é˜¶æ®µ
1. **èµ„æºæ”¶é›†**ï¼šæ‰«ædependå’Œpluginsç›®å½•
2. **å‹ç¼©å¤„ç†**ï¼šå¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©
3. **åŠ å¯†å¤„ç†**ï¼šå¯¹å‹ç¼©åçš„å†…å®¹è¿›è¡ŒåŠ å¯†
4. **é…ç½®ç”Ÿæˆ**ï¼šç”Ÿæˆdepend.jsæ˜ å°„é…ç½®
5. **ä¸»æ–‡ä»¶ç”Ÿæˆ**ï¼šå°†æ‰€æœ‰å†…å®¹æ‰“åŒ…åˆ°main.js

#### 5.2 æ··æ·†ç­–ç•¥
- **æ§åˆ¶æµæ··æ·†**ï¼šæ”¹å˜ä»£ç æ‰§è¡Œæµç¨‹
- **æ ‡è¯†ç¬¦æ··æ·†**ï¼šå˜é‡å’Œå‡½æ•°åéšæœºåŒ–
- **å­—ç¬¦ä¸²åŠ å¯†**ï¼šæ•æ„Ÿå­—ç¬¦ä¸²åŠ å¯†å­˜å‚¨
- **æ­»ä»£ç æ³¨å…¥**ï¼šæ·»åŠ æ— ç”¨ä»£ç å¹²æ‰°åˆ†æ

## æ€§èƒ½ä¼˜åŒ–è€ƒè™‘

### 1. åŠ è½½æ€§èƒ½
- **æ‡’åŠ è½½**ï¼šæŒ‰éœ€è§£å‹å’ŒåŠ è½½èµ„æº
- **é¢„åŠ è½½**ï¼šå…³é”®èµ„æºä¼˜å…ˆè§£å‹
- **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜

### 2. å†…å­˜ä¼˜åŒ–
- **æµå¼è§£å‹**ï¼šå¤§æ–‡ä»¶åˆ†å—å¤„ç†
- **åƒåœ¾å›æ”¶**ï¼šåŠæ—¶æ¸…ç†ä¸´æ—¶å¯¹è±¡
- **å†…å­˜ç›‘æ§**ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨

### 3. å…¼å®¹æ€§å¤„ç†
- **Polyfill**ï¼šä¸ºæ—§æµè§ˆå™¨æä¾›APIæ”¯æŒ
- **é™çº§æ–¹æ¡ˆ**ï¼šä¸æ”¯æŒçš„åŠŸèƒ½æä¾›æ›¿ä»£æ–¹æ¡ˆ
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸æ•è·å’Œå¤„ç†

## å®‰å…¨æ€§è€ƒè™‘

### 1. æ”»å‡»é˜²æŠ¤
- **ä»£ç æ³¨å…¥é˜²æŠ¤**ï¼šä¸¥æ ¼çš„è¾“å…¥éªŒè¯
- **XSSé˜²æŠ¤**ï¼šå†…å®¹å®‰å…¨ç­–ç•¥(CSP)
- **æ—¶é—´æ”»å‡»é˜²æŠ¤**ï¼šæ’å®šæ—¶é—´æ¯”è¾ƒ

### 2. é€†å‘åˆ†æå¯¹æŠ—
- **å¤šå±‚æ··æ·†**ï¼šä»£ç å’Œæ•°æ®åˆ†ç¦»æ··æ·†
- **åŠ¨æ€è§£å¯†**ï¼šè¿è¡Œæ—¶è§£å¯†å…³é”®é€»è¾‘
- **åè™šæ‹Ÿæœº**ï¼šæ£€æµ‹æ²™ç®±ç¯å¢ƒ

## åç»­å¼€å‘è®¡åˆ’

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¶æ„è®¾è®¡ (1-2å‘¨)
1. è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡
2. æ¨¡å—æ¥å£å®šä¹‰
3. æ•°æ®æµç¨‹è®¾è®¡
4. å®‰å…¨ç­–ç•¥åˆ¶å®š

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒæ¨¡å—å¼€å‘ (3-4å‘¨)
1. å‹ç¼©åŠ å¯†æ¨¡å—
2. èµ„æºåŠ«æŒæ¨¡å—
3. Blob URLç®¡ç†æ¨¡å—
4. å®‰å…¨é˜²æŠ¤æ¨¡å—

### é˜¶æ®µä¸‰ï¼šé›†æˆæµ‹è¯• (2-3å‘¨)
1. å•å…ƒæµ‹è¯•ç¼–å†™
2. é›†æˆæµ‹è¯•éªŒè¯
3. æ€§èƒ½åŸºå‡†æµ‹è¯•
4. å®‰å…¨æ€§æµ‹è¯•

### é˜¶æ®µå››ï¼šä¼˜åŒ–å®Œå–„ (2-3å‘¨)
1. æ€§èƒ½ä¼˜åŒ–
2. å…¼å®¹æ€§æµ‹è¯•
3. æ–‡æ¡£å®Œå–„
4. éƒ¨ç½²æ–¹æ¡ˆè®¾è®¡

## 9. å¼€å‘å®æ–½å»ºè®®

### 9.1 æŠ€æœ¯æ ˆé€‰æ‹©
```typescript
// æ¨èæŠ€æœ¯æ ˆ (AIå·¥å…·å‚è€ƒ)
const RECOMMENDED_STACK = {
  language: 'TypeScript',           // ç±»å‹å®‰å…¨ï¼Œä¾¿äºå¤§å‹é¡¹ç›®
  buildTool: 'Webpack 5 / Vite',   // ç°ä»£æ„å»ºå·¥å…·

  // å‹ç¼©ç›¸å…³
  buildTimeCompression: 'Node.js zlib.brotliCompressSync', // æ„å»ºæ—¶å‹ç¼©
  runtimeDecompression: 'Custom WASM Module',              // è¿è¡Œæ—¶è§£å‹
  wasmToolchain: 'Emscripten',      // WASMç¼–è¯‘å·¥å…·é“¾

  // æ··æ·†å’Œä¿æŠ¤
  obfuscation: 'javascript-obfuscator', // ä»£ç æ··æ·†
  wasmOptimization: 'wasm-opt',     // WASMä½“ç§¯ä¼˜åŒ–

  // å¼€å‘å’Œæµ‹è¯•
  testing: 'Jest + Playwright',     // å•å…ƒæµ‹è¯• + E2Eæµ‹è¯•
  debugging: 'Source Map (å¼€å‘æ—¶)', // è°ƒè¯•æ”¯æŒ
};
```

### 9.2 å¼€å‘é˜¶æ®µè§„åˆ’
```typescript
// å¼€å‘é‡Œç¨‹ç¢‘ (AIå·¥å…·æ‰§è¡Œè®¡åˆ’)
const DEVELOPMENT_PHASES = [
  {
    phase: 'Phase 1: åŸºç¡€æ¶æ„',
    duration: '1-2å‘¨',
    deliverables: [
      'å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰',
      'åŸºç¡€å‹ç¼©ç®—æ³•å®ç°',
      'å¯†ç ç®¡ç†ç³»ç»Ÿ',
      'å•å…ƒæµ‹è¯•æ¡†æ¶æ­å»º'
    ],
    success_criteria: [
      'èƒ½å¤Ÿä½¿ç”¨Brotliæœ€é«˜çº§åˆ«å‹ç¼©å’Œè§£å‹å•ä¸ªæ–‡ä»¶',
      'å¯†ç ä¿æŠ¤æœºåˆ¶æ­£å¸¸å·¥ä½œ',
      'å‹ç¼©ç‡è¾¾åˆ°70%ä»¥ä¸Š',
      'æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°80%+'
    ]
  },

  {
    phase: 'Phase 2: æ ¸å¿ƒåŠŸèƒ½',
    duration: '2-3å‘¨',
    deliverables: [
      'SecureCompressorå®Œæ•´å®ç°',
      'MainLoaderè¿è¡Œæ—¶é€»è¾‘',
      'èµ„æºæ‹¦æˆªæœºåˆ¶',
      'Blob URLç®¡ç†ç³»ç»Ÿ'
    ],
    success_criteria: [
      'èƒ½å¤Ÿå¤„ç†å®Œæ•´çš„é¡¹ç›®ç›®å½•',
      'è¿è¡Œæ—¶è§£å‹å’ŒåŠ è½½æ­£å¸¸',
      'èµ„æºæ‹¦æˆª100%æˆåŠŸç‡'
    ]
  },

  {
    phase: 'Phase 3: å®‰å…¨å¢å¼º',
    duration: '1-2å‘¨',
    deliverables: [
      'æŒ‡çº¹è¯†åˆ«ç³»ç»Ÿ',
      'åè°ƒè¯•æœºåˆ¶',
      'å®‰å…¨éªŒè¯æµç¨‹',
      'é”™è¯¯å¤„ç†å’Œä¿æŠ¤æœºåˆ¶'
    ],
    success_criteria: [
      'å®‰å…¨æ£€æŸ¥å‡†ç¡®ç‡95%+',
      'åè°ƒè¯•æœºåˆ¶æœ‰æ•ˆ',
      'å¼‚å¸¸æƒ…å†µä¸‹ä¿æŠ¤æœºåˆ¶æ­£å¸¸è§¦å‘'
    ]
  },

  {
    phase: 'Phase 4: æ„å»ºé›†æˆ',
    duration: '1-2å‘¨',
    deliverables: [
      'ProjectBuilderå®Œæ•´å®ç°',
      'ä»£ç æ··æ·†é›†æˆ',
      'CLIå·¥å…·å¼€å‘',
      'é…ç½®æ–‡ä»¶ç³»ç»Ÿ'
    ],
    success_criteria: [
      'ä¸€é”®æ„å»ºæµç¨‹',
      'æ··æ·†åä»£ç æ­£å¸¸è¿è¡Œ',
      'æ„å»ºäº§ç‰©ç¬¦åˆè§„æ ¼'
    ]
  }
];
```

### 9.3 è´¨é‡ä¿è¯æ£€æŸ¥ç‚¹
```typescript
// AIå·¥å…·è´¨é‡æ£€æŸ¥æ¸…å•
const QUALITY_CHECKPOINTS = {
  functionality: [
    'âœ“ Brotliæœ€é«˜çº§åˆ«å‹ç¼©ç‡è¾¾åˆ°é¢„æœŸ (>75%)',
    'âœ“ è§£å‹é€Ÿåº¦å¯æ¥å— (<3ç§’)',
    'âœ“ å†…å­˜ä½¿ç”¨åˆç† (<åŸå§‹å¤§å°3å€)',
    'âœ“ æ‰€æœ‰èµ„æºæ­£ç¡®åŠ è½½',
    'âœ“ å®‰å…¨æ£€æŸ¥æœºåˆ¶æœ‰æ•ˆ'
  ],

  security: [
    'âœ“ å¯†ç æ— æ³•é€šè¿‡é™æ€åˆ†æè·å–',
    'âœ“ å‹ç¼©æ•°æ®æ— æ³•ç›´æ¥è§£å‹',
    'âœ“ åè°ƒè¯•æœºåˆ¶æ­£å¸¸å·¥ä½œ',
    'âœ“ æŒ‡çº¹è¯†åˆ«å‡†ç¡®æ€§éªŒè¯',
    'âœ“ å¼‚å¸¸æƒ…å†µä¿æŠ¤æœºåˆ¶æµ‹è¯•'
  ],

  compatibility: [
    'âœ“ Chrome 80+ å…¼å®¹æ€§æµ‹è¯•',
    'âœ“ Firefox 75+ å…¼å®¹æ€§æµ‹è¯•',
    'âœ“ Safari 13+ å…¼å®¹æ€§æµ‹è¯•',
    'âœ“ Edge 80+ å…¼å®¹æ€§æµ‹è¯•',
    'âœ“ ç§»åŠ¨ç«¯æµè§ˆå™¨æµ‹è¯•'
  ],

  performance: [
    'âœ“ é¦–æ¬¡åŠ è½½æ—¶é—´ <5ç§’',
    'âœ“ å†…å­˜å³°å€¼ <100MB',
    'âœ“ CPUä½¿ç”¨ç‡ <50%',
    'âœ“ ç½‘ç»œè¯·æ±‚æ‹¦æˆªå»¶è¿Ÿ <10ms'
  ]
};
```

## 10. æ€»ç»“ä¸å±•æœ›

### 10.1 æ–¹æ¡ˆä¼˜åŠ¿
æœ¬JavaScriptäºŒæ¬¡æ‰“åŒ…æºç ä¿æŠ¤æ–¹æ¡ˆé€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ‰‹æ®µï¼Œå®ç°äº†é«˜æ•ˆçš„æºç ä¿æŠ¤ï¼š

1. **ï¿½ï¸ æè‡´å‹ç¼©**ï¼šBrotliæœ€é«˜çº§åˆ«å‹ç¼©ï¼Œæœ€å¤§åŒ–å‡å°‘æ–‡ä»¶ä½“ç§¯
2. **ğŸš€ åŠ¨æ€è§£å‹åŠ è½½**ï¼šè¿è¡Œæ—¶è§£å‹ï¼ŒBlob URLæŠ€æœ¯éšè—çœŸå®è·¯å¾„
3. **ğŸ›¡ï¸ å®Œæ•´èµ„æºåŠ«æŒ**ï¼šService Worker + FetchåŠ«æŒåŒé‡ä¿éšœ
4. **ğŸ” å¤šé‡å®‰å…¨æ£€æŸ¥**ï¼šæŒ‡çº¹è¯†åˆ« + åè°ƒè¯• + ç¯å¢ƒéªŒè¯
5. **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šåˆ†å±‚è§£å‹ï¼ŒæŒ‰éœ€åŠ è½½ï¼Œå†…å­˜ç®¡ç†
6. **ğŸ”§ å¼€å‘å‹å¥½**ï¼šå®Œæ•´TypeScriptæ”¯æŒï¼Œæ¨¡å—åŒ–è®¾è®¡
7. **ğŸ“¦ ç®€åŒ–æ¶æ„**ï¼šå»é™¤å¯†ç å¤æ‚åº¦ï¼Œä¸“æ³¨å‹ç¼©å’Œæ··æ·†ä¿æŠ¤

### 10.2 æŠ€æœ¯åˆ›æ–°ç‚¹
- **åˆ†å±‚è§£å‹æœºåˆ¶**ï¼šé¦–åˆ›pluginsä¼˜å…ˆè§£å‹çš„å®‰å…¨æ£€æŸ¥æ¨¡å¼
- **æè‡´å‹ç¼©ç­–ç•¥**ï¼šBrotliæœ€é«˜çº§åˆ«å‹ç¼©ï¼Œæœ€å¤§åŒ–å‡å°‘ä½“ç§¯
- **WASMåŠ¨æ€åŠ è½½**ï¼šè§£å‹å™¨ä»¥WASMå½¢å¼å†…åµŒï¼Œé¿å…å¤–éƒ¨ä¾èµ–
- **åˆ†åŒºæ··æ·†ç­–ç•¥**ï¼šæ•°æ®åŒºåŸŸä¿æŠ¤ + é€»è¾‘åŒºåŸŸå¼ºæ··æ·†
- **UUIDèµ„æºæ˜ å°„**ï¼šåŠ¨æ€ç”Ÿæˆï¼Œæ¯æ¬¡åŠ è½½è·¯å¾„ä¸åŒ
- **åŒé‡æ‹¦æˆªä¿éšœ**ï¼šService Worker + FetchåŠ«æŒç¡®ä¿100%æ‹¦æˆªç‡

### 10.3 å…³é”®å®ç°æ³¨æ„äº‹é¡¹

#### 10.3.1 æ··æ·†å®ç°è¦ç‚¹
```typescript
// AIå¼€å‘å·¥å…·å®ç°æç¤º
const OBFUSCATION_GUIDELINES = {
  dataProtection: {
    rule: "ç»å¯¹ä¸èƒ½æ··æ·†å‹ç¼©æ•°æ®å’ŒWASMäºŒè¿›åˆ¶",
    reason: "æ··æ·†ä¼šç ´åäºŒè¿›åˆ¶æ•°æ®å®Œæ•´æ€§",
    implementation: "ä½¿ç”¨åŒºåŸŸæ ‡è®°å’Œæ­£åˆ™è¡¨è¾¾å¼ä¿æŠ¤"
  },

  logicObfuscation: {
    rule: "æ‰€æœ‰è§£å‹å’ŒåŠ è½½é€»è¾‘å¿…é¡»å¼ºæ··æ·†",
    reason: "é˜²æ­¢é€†å‘åˆ†æè·å–è§£å‹ç®—æ³•",
    targets: [
      "WASMåŠ è½½å‡½æ•°",
      "HEXè½¬æ¢å‡½æ•°",
      "è§£å‹è°ƒç”¨é€»è¾‘",
      "èµ„æºæ‹¦æˆªä»£ç "
    ]
  },

  performanceBalance: {
    rule: "æ··æ·†å¼ºåº¦ä¸æ€§èƒ½çš„å¹³è¡¡",
    recommendation: "æ§åˆ¶æµæ··æ·† + å­—ç¬¦ä¸²åŠ å¯†ï¼Œé¿å…è¿‡åº¦æ­»ä»£ç æ³¨å…¥"
  }
};
```

#### 10.3.2 WASMé›†æˆè¦ç‚¹
```typescript
const WASM_INTEGRATION_TIPS = {
  compilation: {
    tip: "ä½¿ç”¨Emscriptenç¼–è¯‘Brotli Cä»£ç ",
    command: "emcc -Os -s WASM=1 -s EXPORTED_FUNCTIONS='[\"_brotli_decompress\"]'",
    optimization: "ä½¿ç”¨-Osä¼˜åŒ–ä½“ç§¯ï¼Œé¿å…-O3å¢åŠ ä¸å¿…è¦çš„ä»£ç "
  },

  memoryManagement: {
    tip: "WASMå†…å­˜ç®¡ç†è‡³å…³é‡è¦",
    implementation: "å¿…é¡»æ­£ç¡®å®ç°malloc/freeï¼Œé¿å…å†…å­˜æ³„æ¼"
  },

  errorHandling: {
    tip: "WASMåŠ è½½å¤±è´¥çš„é™çº§æ–¹æ¡ˆ",
    fallback: "å¯è€ƒè™‘å†…ç½®JavaScriptç‰ˆæœ¬çš„Brotliä½œä¸ºå¤‡é€‰"
  }
};
```

#### 10.3.3 æ„å»ºæµç¨‹è¦ç‚¹
```typescript
const BUILD_PROCESS_CHECKLIST = {
  step1: "ç¼–è¯‘Brotli WASMæ¨¡å—å¹¶è½¬æ¢ä¸ºHEX",
  step2: "ä½¿ç”¨Node.js Brotliå‹ç¼©pluginså’Œdependç›®å½•",
  step3: "ç”ŸæˆåŒ…å«æ•°æ®åŒºåŸŸæ ‡è®°çš„main.jsæ¨¡æ¿",
  step4: "åº”ç”¨æ··æ·†æ—¶è·³è¿‡æ•°æ®åŒºåŸŸï¼Œåªæ··æ·†é€»è¾‘ä»£ç ",
  step5: "éªŒè¯æœ€ç»ˆäº§ç‰©çš„æ•°æ®å®Œæ•´æ€§å’ŒåŠŸèƒ½æ­£ç¡®æ€§",

  criticalCheck: "ç¡®ä¿å‹ç¼©æ•°æ®å’ŒWASM HEXåœ¨æ··æ·†åä¿æŒä¸å˜"
};
```

### 10.3 é€‚ç”¨åœºæ™¯
- ğŸ¢ ä¼ä¸šçº§JavaScriptåº”ç”¨æºç ä¿æŠ¤
- ğŸ’° å•†ä¸šè½¯ä»¶é˜²ç›—ç‰ˆä¿æŠ¤
- ğŸ” æ•æ„Ÿç®—æ³•å’Œä¸šåŠ¡é€»è¾‘ä¿æŠ¤
- ğŸŒ Webåº”ç”¨åé€†å‘å·¥ç¨‹

### 10.4 åç»­æ‰©å±•æ–¹å‘
- æ”¯æŒWebAssemblyæ¨¡å—ä¿æŠ¤
- é›†æˆåŒºå—é“¾éªŒè¯æœºåˆ¶
- æ·»åŠ äº‘ç«¯å¯†é’¥ç®¡ç†
- æ”¯æŒå¤šå¹³å°æ„å»º (Node.js, Electronç­‰)

---

**ğŸ“‹ AIå¼€å‘å·¥å…·æç¤º**: æœ¬æ–‡æ¡£æä¾›äº†å®Œæ•´çš„æŠ€æœ¯è§„æ ¼å’Œå®ç°æŒ‡å—ï¼Œå¯ç›´æ¥ç”¨äºä»£ç ç”Ÿæˆå’Œé¡¹ç›®æ„å»ºã€‚æ‰€æœ‰æ¥å£å®šä¹‰ã€ç±»å‹å£°æ˜å’Œå®ç°ç¤ºä¾‹éƒ½ç»è¿‡ä»”ç»†è®¾è®¡ï¼Œç¡®ä¿æŠ€æœ¯å¯è¡Œæ€§å’Œä»£ç è´¨é‡ã€‚
